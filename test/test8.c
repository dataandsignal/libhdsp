/*
 * This file is part of libhdsp - Handy DSP routines library
 *
 * Copyright (c) 2023 Data And Signal - IT Solutions
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 *   Redistributions of source code must retain the above copyright
 *   notice, this list of conditions and the following disclaimer.
 *
 *   Redistributions in binary form must reproduce the above
 *   copyright notice, this list of conditions and the following
 *   disclaimer in the documentation and/or other materials provided
 *   with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
 * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 * COPYRIGHT HOLDERS OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
 * OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Piotr Gregor <piotr@dataandsignal.com>
 * Data And Signal - IT Solutions
 *
 * test8.c - Test FIR lowpass filter
 */


#include "hdsp.h"

int main(int argc, char **argv) {

    #define PASSBAND_FREQ_HZ 8000
    #define FS_HZ 48000
    #define NUMBER_OF_POINTS 71

    // Input

    // Output
    hdsp_filter_t filter = {0};


    // Reference, using MATLAB's x_fir(8000, 48000, 71, 0)
    double filter_ref[NUMBER_OF_POINTS] = {
            -0.007876, -0.008108, -0.000000, 0.008615, 0.008892, -0.000000, -0.009506,
            -0.009845, 0.000000, 0.010602, 0.011027, -0.000000, -0.011985, -0.012530,
            -0.000000, 0.013783, 0.014509, 0.000000, -0.016216, -0.017229,
            -0.000000, 0.019690, 0.021205, 0.000000, -0.025060, -0.027566,
            -0.000000, 0.034458, 0.039381, -0.000000, -0.055133, -0.068916,
            -0.000000, 0.137832, 0.275664, 0.333333, 0.275664, 0.137832,
            -0.000000, -0.068916, -0.055133, -0.000000, 0.039381, 0.034458,
            -0.000000, -0.027566, -0.025060, 0.000000, 0.021205, 0.019690,
            -0.000000, -0.017229, -0.016216, 0.000000, 0.014509, 0.013783,
            -0.000000, -0.012530, -0.011985, -0.000000, 0.011027, 0.010602,
            0.000000, -0.009845, -0.009506, -0.000000, 0.008892, 0.008615,
            -0.000000, -0.008108, -0.007876
    };

    double v = 0.0;
    uint16_t n = 0;
    double beta = 0.0;
    double w[HDSP_FIR_FILTER_LEN_MAX] = {0};

    double lowpass_4000_8000_ref[57] = {
            0.0002317719, 0.0002933296, 0.0000653322, -0.0005152687,
            -0.0011996204, -0.0014443471, -0.0007086233, 0.0010787318,
            0.0031880267, 0.0042290905, 0.0028736999, -0.0011307916,
            -0.0062838011, -0.0096164325, -0.0081152050, -0.0007340415,
            0.0101430054, 0.0189368961, 0.0192239944, 0.0074220577,
            -0.0139930822, -0.0357312183, -0.0444435302, -0.0283134534,
            0.0168563899, 0.0840521946, 0.1560909305, 0.2113680921,
            0.2320833333, 0.2113680921, 0.1560909305, 0.0840521946,
            0.0168563899, -0.0283134534, -0.0444435302, -0.0357312183,
            -0.0139930822, 0.0074220577, 0.0192239944, 0.0189368961,
            0.0101430054, -0.0007340415, -0.0081152050, -0.0096164325,
            -0.0062838011, -0.0011307916, 0.0028736999, 0.0042290905,
            0.0031880267, 0.0010787318, -0.0007086233, -0.0014443471,
            -0.0011996204, -0.0005152687, 0.0000653322, 0.0002933296,
            0.0002317719
    };

    int16_t x_ref[960] = {
            1, 2, 3, 4, 5, 6, 7, 8, 9, 10,
            11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
            21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
            31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
            41, 42, 43, 44, 45, 46, 47, 48, 49, 50,
            51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
            61, 62, 63, 64, 65, 66, 67, 68, 69, 70,
            71, 72, 73, 74, 75, 76, 77, 78, 79, 80,
            81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
            91, 92, 93, 94, 95, 96, 97, 98, 99, 100,
            101, 102, 103, 104, 105, 106, 107, 108, 109, 110,
            111, 112, 113, 114, 115, 116, 117, 118, 119, 120,
            121, 122, 123, 124, 125, 126, 127, 128, 129, 130,
            131, 132, 133, 134, 135, 136, 137, 138, 139, 140,
            141, 142, 143, 144, 145, 146, 147, 148, 149, 150,
            151, 152, 153, 154, 155, 156, 157, 158, 159, 160,
            161, 162, 163, 164, 165, 166, 167, 168, 169, 170,
            171, 172, 173, 174, 175, 176, 177, 178, 179, 180,
            181, 182, 183, 184, 185, 186, 187, 188, 189, 190,
            191, 192, 193, 194, 195, 196, 197, 198, 199, 200,
            201, 202, 203, 204, 205, 206, 207, 208, 209, 210,
            211, 212, 213, 214, 215, 216, 217, 218, 219, 220,
            221, 222, 223, 224, 225, 226, 227, 228, 229, 230,
            231, 232, 233, 234, 235, 236, 237, 238, 239, 240,
            241, 242, 243, 244, 245, 246, 247, 248, 249, 250,
            251, 252, 253, 254, 255, 256, 257, 258, 259, 260,
            261, 262, 263, 264, 265, 266, 267, 268, 269, 270,
            271, 272, 273, 274, 275, 276, 277, 278, 279, 280,
            281, 282, 283, 284, 285, 286, 287, 288, 289, 290,
            291, 292, 293, 294, 295, 296, 297, 298, 299, 300,
            301, 302, 303, 304, 305, 306, 307, 308, 309, 310,
            311, 312, 313, 314, 315, 316, 317, 318, 319, 320,
            321, 322, 323, 324, 325, 326, 327, 328, 329, 330,
            331, 332, 333, 334, 335, 336, 337, 338, 339, 340,
            341, 342, 343, 344, 345, 346, 347, 348, 349, 350,
            351, 352, 353, 354, 355, 356, 357, 358, 359, 360,
            361, 362, 363, 364, 365, 366, 367, 368, 369, 370,
            371, 372, 373, 374, 375, 376, 377, 378, 379, 380,
            381, 382, 383, 384, 385, 386, 387, 388, 389, 390,
            391, 392, 393, 394, 395, 396, 397, 398, 399, 400,
            401, 402, 403, 404, 405, 406, 407, 408, 409, 410,
            411, 412, 413, 414, 415, 416, 417, 418, 419, 420,
            421, 422, 423, 424, 425, 426, 427, 428, 429, 430,
            431, 432, 433, 434, 435, 436, 437, 438, 439, 440,
            441, 442, 443, 444, 445, 446, 447, 448, 449, 450,
            451, 452, 453, 454, 455, 456, 457, 458, 459, 460,
            461, 462, 463, 464, 465, 466, 467, 468, 469, 470,
            471, 472, 473, 474, 475, 476, 477, 478, 479, 480,
            481, 482, 483, 484, 485, 486, 487, 488, 489, 490,
            491, 492, 493, 494, 495, 496, 497, 498, 499, 500,
            501, 502, 503, 504, 505, 506, 507, 508, 509, 510,
            511, 512, 513, 514, 515, 516, 517, 518, 519, 520,
            521, 522, 523, 524, 525, 526, 527, 528, 529, 530,
            531, 532, 533, 534, 535, 536, 537, 538, 539, 540,
            541, 542, 543, 544, 545, 546, 547, 548, 549, 550,
            551, 552, 553, 554, 555, 556, 557, 558, 559, 560,
            561, 562, 563, 564, 565, 566, 567, 568, 569, 570,
            571, 572, 573, 574, 575, 576, 577, 578, 579, 580,
            581, 582, 583, 584, 585, 586, 587, 588, 589, 590,
            591, 592, 593, 594, 595, 596, 597, 598, 599, 600,
            601, 602, 603, 604, 605, 606, 607, 608, 609, 610,
            611, 612, 613, 614, 615, 616, 617, 618, 619, 620,
            621, 622, 623, 624, 625, 626, 627, 628, 629, 630,
            631, 632, 633, 634, 635, 636, 637, 638, 639, 640,
            641, 642, 643, 644, 645, 646, 647, 648, 649, 650,
            651, 652, 653, 654, 655, 656, 657, 658, 659, 660,
            661, 662, 663, 664, 665, 666, 667, 668, 669, 670,
            671, 672, 673, 674, 675, 676, 677, 678, 679, 680,
            681, 682, 683, 684, 685, 686, 687, 688, 689, 690,
            691, 692, 693, 694, 695, 696, 697, 698, 699, 700,
            701, 702, 703, 704, 705, 706, 707, 708, 709, 710,
            711, 712, 713, 714, 715, 716, 717, 718, 719, 720,
            721, 722, 723, 724, 725, 726, 727, 728, 729, 730,
            731, 732, 733, 734, 735, 736, 737, 738, 739, 740,
            741, 742, 743, 744, 745, 746, 747, 748, 749, 750,
            751, 752, 753, 754, 755, 756, 757, 758, 759, 760,
            761, 762, 763, 764, 765, 766, 767, 768, 769, 770,
            771, 772, 773, 774, 775, 776, 777, 778, 779, 780,
            781, 782, 783, 784, 785, 786, 787, 788, 789, 790,
            791, 792, 793, 794, 795, 796, 797, 798, 799, 800,
            801, 802, 803, 804, 805, 806, 807, 808, 809, 810,
            811, 812, 813, 814, 815, 816, 817, 818, 819, 820,
            821, 822, 823, 824, 825, 826, 827, 828, 829, 830,
            831, 832, 833, 834, 835, 836, 837, 838, 839, 840,
            841, 842, 843, 844, 845, 846, 847, 848, 849, 850,
            851, 852, 853, 854, 855, 856, 857, 858, 859, 860,
            861, 862, 863, 864, 865, 866, 867, 868, 869, 870,
            871, 872, 873, 874, 875, 876, 877, 878, 879, 880,
            881, 882, 883, 884, 885, 886, 887, 888, 889, 890,
            891, 892, 893, 894, 895, 896, 897, 898, 899, 900,
            901, 902, 903, 904, 905, 906, 907, 908, 909, 910,
            911, 912, 913, 914, 915, 916, 917, 918, 919, 920,
            921, 922, 923, 924, 925, 926, 927, 928, 929, 930,
            931, 932, 933, 934, 935, 936, 937, 938, 939, 940,
            941, 942, 943, 944, 945, 946, 947, 948, 949, 950,
            951, 952, 953, 954, 955, 956, 957, 958, 959, 960
    };
    double y_57_ref[960] = {
            1.03476120, 1.86203676, 2.84540324, 3.91282192, 4.99709699,
            6.05305860, 7.06457669, 8.04036355, 9.00215734, 9.97137318,
            10.95981302, 11.96718975, 12.98470949, 14.00149518, 15.01016567,
            16.00921973, 17.00198999, 17.99362946, 18.98814262, 19.98688488,
            20.98881516, 21.99182418, 22.99412457, 23.99498062, 24.99463704,
            25.99377820, 26.99298468, 27.99248450, 28.99221609, 29.99194768,
            30.99167927, 31.99141086, 32.99114245, 33.99087404, 34.99060563,
            35.99033721, 36.99006880, 37.98980039, 38.98953198, 39.98926357,
            40.98899516, 41.98872675, 42.98845834, 43.98818993, 44.98792152,
            45.98765311, 46.98738470, 47.98711629, 48.98684788, 49.98657947,
            50.98631105, 51.98604264, 52.98577423, 53.98550582, 54.98523741,
            55.98496900, 56.98470059, 57.98443218, 58.98416377, 59.98389536,
            60.98362695, 61.98335854, 62.98309013, 63.98282172, 64.98255330,
            65.98228489, 66.98201648, 67.98174807, 68.98147966, 69.98121125,
            70.98094284, 71.98067443, 72.98040602, 73.98013761, 74.97986920,
            75.97960079, 76.97933238, 77.97906397, 78.97879555, 79.97852714,
            80.97825873, 81.97799032, 82.97772191, 83.97745350, 84.97718509,
            85.97691668, 86.97664827, 87.97637986, 88.97611145, 89.97584304,
            90.97557463, 91.97530622, 92.97503780, 93.97476939, 94.97450098,
            95.97423257, 96.97396416, 97.97369575, 98.97342734, 99.97315893,
            100.97289052, 101.97262211, 102.97235370, 103.97208529, 104.97181688,
            105.97154847, 106.97128006, 107.97101164, 108.97074323, 109.97047482,
            110.97020641, 111.96993800, 112.96966959, 113.96940118, 114.96913277,
            115.96886436, 116.96859595, 117.96832754, 118.96805913, 119.96779072,
            120.96752231, 121.96725389, 122.96698548, 123.96671707, 124.96644866,
            125.96618025, 126.96591184, 127.96564343, 128.96537502, 129.96510661,
            130.96483820, 131.96456979, 132.96430138, 133.96403297, 134.96376456,
            135.96349614, 136.96322773, 137.96295932, 138.96269091, 139.96242250,
            140.96215409, 141.96188568, 142.96161727, 143.96134886, 144.96108045,
            145.96081204, 146.96054363, 147.96027522, 148.96000681, 149.95973840,
            150.95946998, 151.95920157, 152.95893316, 153.95866475, 154.95839634,
            155.95812793, 156.95785952, 157.95759111, 158.95732270, 159.95705429,
            160.95678588, 161.95651747, 162.95624906, 163.95598065, 164.95571223,
            165.95544382, 166.95517541, 167.95490700, 168.95463859, 169.95437018,
            170.95410177, 171.95383336, 172.95356495, 173.95329654, 174.95302813,
            175.95275972, 176.95249131, 177.95222290, 178.95195448, 179.95168607,
            180.95141766, 181.95114925, 182.95088084, 183.95061243, 184.95034402,
            185.95007561, 186.94980720, 187.94953879, 188.94927038, 189.94900197,
            190.94873356, 191.94846515, 192.94819673, 193.94792832, 194.94765991,
            195.94739150, 196.94712309, 197.94685468, 198.94658627, 199.94631786,
            200.94604945, 201.94578104, 202.94551263, 203.94524422, 204.94497581,
            205.94470740, 206.94443899, 207.94417057, 208.94390216, 209.94363375,
            210.94336534, 211.94309693, 212.94282852, 213.94256011, 214.94229170,
            215.94202329, 216.94175488, 217.94148647, 218.94121806, 219.94094965,
            220.94068124, 221.94041282, 222.94014441, 223.93987600, 224.93960759,
            225.93933918, 226.93907077, 227.93880236, 228.93853395, 229.93826554,
            230.93799713, 231.93772872, 232.93746031, 233.93719190, 234.93692349,
            235.93665507, 236.93638666, 237.93611825, 238.93584984, 239.93558143,
            240.93531302, 241.93504461, 242.93477620, 243.93450779, 244.93423938,
            245.93397097, 246.93370256, 247.93343415, 248.93316574, 249.93289733,
            250.93262891, 251.93236050, 252.93209209, 253.93182368, 254.93155527,
            255.93128686, 256.93101845, 257.93075004, 258.93048163, 259.93021322,
            260.92994481, 261.92967640, 262.92940799, 263.92913958, 264.92887116,
            265.92860275, 266.92833434, 267.92806593, 268.92779752, 269.92752911,
            270.92726070, 271.92699229, 272.92672388, 273.92645547, 274.92618706,
            275.92591865, 276.92565024, 277.92538183, 278.92511341, 279.92484500,
            280.92457659, 281.92430818, 282.92403977, 283.92377136, 284.92350295,
            285.92323454, 286.92296613, 287.92269772, 288.92242931, 289.92216090,
            290.92189249, 291.92162408, 292.92135566, 293.92108725, 294.92081884,
            295.92055043, 296.92028202, 297.92001361, 298.91974520, 299.91947679,
            300.91920838, 301.91893997, 302.91867156, 303.91840315, 304.91813474,
            305.91786633, 306.91759792, 307.91732950, 308.91706109, 309.91679268,
            310.91652427, 311.91625586, 312.91598745, 313.91571904, 314.91545063,
            315.91518222, 316.91491381, 317.91464540, 318.91437699, 319.91410858,
            320.91384017, 321.91357175, 322.91330334, 323.91303493, 324.91276652,
            325.91249811, 326.91222970, 327.91196129, 328.91169288, 329.91142447,
            330.91115606, 331.91088765, 332.91061924, 333.91035083, 334.91008242,
            335.90981400, 336.90954559, 337.90927718, 338.90900877, 339.90874036,
            340.90847195, 341.90820354, 342.90793513, 343.90766672, 344.90739831,
            345.90712990, 346.90686149, 347.90659308, 348.90632467, 349.90605626,
            350.90578784, 351.90551943, 352.90525102, 353.90498261, 354.90471420,
            355.90444579, 356.90417738, 357.90390897, 358.90364056, 359.90337215,
            360.90310374, 361.90283533, 362.90256692, 363.90229851, 364.90203009,
            365.90176168, 366.90149327, 367.90122486, 368.90095645, 369.90068804,
            370.90041963, 371.90015122, 372.89988281, 373.89961440, 374.89934599,
            375.89907758, 376.89880917, 377.89854076, 378.89827234, 379.89800393,
            380.89773552, 381.89746711, 382.89719870, 383.89693029, 384.89666188,
            385.89639347, 386.89612506, 387.89585665, 388.89558824, 389.89531983,
            390.89505142, 391.89478301, 392.89451459, 393.89424618, 394.89397777,
            395.89370936, 396.89344095, 397.89317254, 398.89290413, 399.89263572,
            400.89236731, 401.89209890, 402.89183049, 403.89156208, 404.89129367,
            405.89102526, 406.89075685, 407.89048843, 408.89022002, 409.88995161,
            410.88968320, 411.88941479, 412.88914638, 413.88887797, 414.88860956,
            415.88834115, 416.88807274, 417.88780433, 418.88753592, 419.88726751,
            420.88699910, 421.88673068, 422.88646227, 423.88619386, 424.88592545,
            425.88565704, 426.88538863, 427.88512022, 428.88485181, 429.88458340,
            430.88431499, 431.88404658, 432.88377817, 433.88350976, 434.88324135,
            435.88297293, 436.88270452, 437.88243611, 438.88216770, 439.88189929,
            440.88163088, 441.88136247, 442.88109406, 443.88082565, 444.88055724,
            445.88028883, 446.88002042, 447.87975201, 448.87948360, 449.87921519,
            450.87894677, 451.87867836, 452.87840995, 453.87814154, 454.87787313,
            455.87760472, 456.87733631, 457.87706790, 458.87679949, 459.87653108,
            460.87626267, 461.87599426, 462.87572585, 463.87545744, 464.87518902,
            465.87492061, 466.87465220, 467.87438379, 468.87411538, 469.87384697,
            470.87357856, 471.87331015, 472.87304174, 473.87277333, 474.87250492,
            475.87223651, 476.87196810, 477.87169969, 478.87143127, 479.87116286,
            480.87089445, 481.87062604, 482.87035763, 483.87008922, 484.86982081,
            485.86955240, 486.86928399, 487.86901558, 488.86874717, 489.86847876,
            490.86821035, 491.86794194, 492.86767352, 493.86740511, 494.86713670,
            495.86686829, 496.86659988, 497.86633147, 498.86606306, 499.86579465,
            500.86552624, 501.86525783, 502.86498942, 503.86472101, 504.86445260,
            505.86418419, 506.86391578, 507.86364736, 508.86337895, 509.86311054,
            510.86284213, 511.86257372, 512.86230531, 513.86203690, 514.86176849,
            515.86150008, 516.86123167, 517.86096326, 518.86069485, 519.86042644,
            520.86015803, 521.85988961, 522.85962120, 523.85935279, 524.85908438,
            525.85881597, 526.85854756, 527.85827915, 528.85801074, 529.85774233,
            530.85747392, 531.85720551, 532.85693710, 533.85666869, 534.85640028,
            535.85613186, 536.85586345, 537.85559504, 538.85532663, 539.85505822,
            540.85478981, 541.85452140, 542.85425299, 543.85398458, 544.85371617,
            545.85344776, 546.85317935, 547.85291094, 548.85264253, 549.85237411,
            550.85210570, 551.85183729, 552.85156888, 553.85130047, 554.85103206,
            555.85076365, 556.85049524, 557.85022683, 558.84995842, 559.84969001,
            560.84942160, 561.84915319, 562.84888478, 563.84861637, 564.84834795,
            565.84807954, 566.84781113, 567.84754272, 568.84727431, 569.84700590,
            570.84673749, 571.84646908, 572.84620067, 573.84593226, 574.84566385,
            575.84539544, 576.84512703, 577.84485862, 578.84459020, 579.84432179,
            580.84405338, 581.84378497, 582.84351656, 583.84324815, 584.84297974,
            585.84271133, 586.84244292, 587.84217451, 588.84190610, 589.84163769,
            590.84136928, 591.84110087, 592.84083245, 593.84056404, 594.84029563,
            595.84002722, 596.83975881, 597.83949040, 598.83922199, 599.83895358,
            600.83868517, 601.83841676, 602.83814835, 603.83787994, 604.83761153,
            605.83734312, 606.83707471, 607.83680629, 608.83653788, 609.83626947,
            610.83600106, 611.83573265, 612.83546424, 613.83519583, 614.83492742,
            615.83465901, 616.83439060, 617.83412219, 618.83385378, 619.83358537,
            620.83331696, 621.83304854, 622.83278013, 623.83251172, 624.83224331,
            625.83197490, 626.83170649, 627.83143808, 628.83116967, 629.83090126,
            630.83063285, 631.83036444, 632.83009603, 633.82982762, 634.82955921,
            635.82929079, 636.82902238, 637.82875397, 638.82848556, 639.82821715,
            640.82794874, 641.82768033, 642.82741192, 643.82714351, 644.82687510,
            645.82660669, 646.82633828, 647.82606987, 648.82580146, 649.82553304,
            650.82526463, 651.82499622, 652.82472781, 653.82445940, 654.82419099,
            655.82392258, 656.82365417, 657.82338576, 658.82311735, 659.82284894,
            660.82258053, 661.82231212, 662.82204371, 663.82177530, 664.82150688,
            665.82123847, 666.82097006, 667.82070165, 668.82043324, 669.82016483,
            670.81989642, 671.81962801, 672.81935960, 673.81909119, 674.81882278,
            675.81855437, 676.81828596, 677.81801755, 678.81774913, 679.81748072,
            680.81721231, 681.81694390, 682.81667549, 683.81640708, 684.81613867,
            685.81587026, 686.81560185, 687.81533344, 688.81506503, 689.81479662,
            690.81452821, 691.81425980, 692.81399138, 693.81372297, 694.81345456,
            695.81318615, 696.81291774, 697.81264933, 698.81238092, 699.81211251,
            700.81184410, 701.81157569, 702.81130728, 703.81103887, 704.81077046,
            705.81050205, 706.81023364, 707.80996522, 708.80969681, 709.80942840,
            710.80915999, 711.80889158, 712.80862317, 713.80835476, 714.80808635,
            715.80781794, 716.80754953, 717.80728112, 718.80701271, 719.80674430,
            720.80647589, 721.80620747, 722.80593906, 723.80567065, 724.80540224,
            725.80513383, 726.80486542, 727.80459701, 728.80432860, 729.80406019,
            730.80379178, 731.80352337, 732.80325496, 733.80298655, 734.80271814,
            735.80244972, 736.80218131, 737.80191290, 738.80164449, 739.80137608,
            740.80110767, 741.80083926, 742.80057085, 743.80030244, 744.80003403,
            745.79976562, 746.79949721, 747.79922880, 748.79896039, 749.79869198,
            750.79842356, 751.79815515, 752.79788674, 753.79761833, 754.79734992,
            755.79708151, 756.79681310, 757.79654469, 758.79627628, 759.79600787,
            760.79573946, 761.79547105, 762.79520264, 763.79493423, 764.79466581,
            765.79439740, 766.79412899, 767.79386058, 768.79359217, 769.79332376,
            770.79305535, 771.79278694, 772.79251853, 773.79225012, 774.79198171,
            775.79171330, 776.79144489, 777.79117648, 778.79090806, 779.79063965,
            780.79037124, 781.79010283, 782.78983442, 783.78956601, 784.78929760,
            785.78902919, 786.78876078, 787.78849237, 788.78822396, 789.78795555,
            790.78768714, 791.78741873, 792.78715031, 793.78688190, 794.78661349,
            795.78634508, 796.78607667, 797.78580826, 798.78553985, 799.78527144,
            800.78500303, 801.78473462, 802.78446621, 803.78419780, 804.78392939,
            805.78366098, 806.78339257, 807.78312415, 808.78285574, 809.78258733,
            810.78231892, 811.78205051, 812.78178210, 813.78151369, 814.78124528,
            815.78097687, 816.78070846, 817.78044005, 818.78017164, 819.77990323,
            820.77963482, 821.77936640, 822.77909799, 823.77882958, 824.77856117,
            825.77829276, 826.77802435, 827.77775594, 828.77748753, 829.77721912,
            830.77695071, 831.77668230, 832.77641389, 833.77614548, 834.77587707,
            835.77560865, 836.77534024, 837.77507183, 838.77480342, 839.77453501,
            840.77426660, 841.77399819, 842.77372978, 843.77346137, 844.77319296,
            845.77292455, 846.77265614, 847.77238773, 848.77211932, 849.77185090,
            850.77158249, 851.77131408, 852.77104567, 853.77077726, 854.77050885,
            855.77024044, 856.76997203, 857.76970362, 858.76943521, 859.76916680,
            860.76889839, 861.76862998, 862.76836157, 863.76809316, 864.76782474,
            865.76755633, 866.76728792, 867.76701951, 868.76675110, 869.76648269,
            870.76621428, 871.76594587, 872.76567746, 873.76540905, 874.76514064,
            875.76487223, 876.76460382, 877.76433541, 878.76406699, 879.76379858,
            880.76353017, 881.76326176, 882.76299335, 883.76272494, 884.76245653,
            885.76218812, 886.76191971, 887.76165130, 888.76138289, 889.76111448,
            890.76084607, 891.76057766, 892.76030924, 893.76004083, 894.75977242,
            895.75950401, 896.75923560, 897.75896719, 898.75869878, 899.75843037,
            900.75816196, 901.75789355, 902.75762514, 903.75735673, 904.75708832,
            905.75681991, 906.75655150, 907.75628308, 908.75601467, 909.75574626,
            910.75547785, 911.75520944, 912.75494103, 913.75467262, 914.75440421,
            915.75413580, 916.75386739, 917.75359898, 918.75333057, 919.75306216,
            920.75279375, 921.75252533, 922.75225692, 923.75198851, 924.75172010,
            925.75145169, 926.75118328, 927.75091487, 928.75064646, 929.75037805,
            930.75010964, 931.74984123, 932.52684002, 933.24445009, 934.18087234,
            935.67518671, 937.82767834, 940.21655195, 941.89983933, 941.86618709,
            939.80442371, 936.73901000, 934.97189756, 937.05022775, 944.08173087,
            954.32217656, 963.12955906, 964.85175863, 956.12185018, 938.93086976,
            921.44505098, 915.28166937, 929.69081515, 965.00430281, 1008.72605341,
            1036.99124374, 1021.87652812, 942.16978779, 793.14977006, 590.85230911
    };
    double y_75_ref[960] = {
            0.92113678, 1.91135172, 3.00553476, 4.05032128, 5.01857680,
            5.97327173, 6.96931552, 7.99892373, 9.01919472, 10.00926197,
            10.98787639, 11.98233397, 12.99531077, 14.00752862, 15.00496017,
            15.99382826, 16.98885408, 17.99431237, 19.00145603, 20.00161848,
            20.99620568, 21.99268775, 22.99453063, 23.99820828, 24.99902254,
            25.99677486, 26.99477382, 27.99510222, 28.99662349, 29.99723285,
            30.99651451, 31.99564407, 32.99553688, 33.99594076, 34.99616685,
            35.99601576, 36.99576999, 37.99565567, 38.99554134, 39.99542702,
            40.99531269, 41.99519837, 42.99508404, 43.99496972, 44.99485539,
            45.99474107, 46.99462674, 47.99451242, 48.99439809, 49.99428377,
            50.99416945, 51.99405512, 52.99394080, 53.99382647, 54.99371215,
            55.99359782, 56.99348350, 57.99336917, 58.99325485, 59.99314052,
            60.99302620, 61.99291187, 62.99279755, 63.99268323, 64.99256890,
            65.99245458, 66.99234025, 67.99222593, 68.99211160, 69.99199728,
            70.99188295, 71.99176863, 72.99165430, 73.99153998, 74.99142565,
            75.99131133, 76.99119701, 77.99108268, 78.99096836, 79.99085403,
            80.99073971, 81.99062538, 82.99051106, 83.99039673, 84.99028241,
            85.99016808, 86.99005376, 87.98993944, 88.98982511, 89.98971079,
            90.98959646, 91.98948214, 92.98936781, 93.98925349, 94.98913916,
            95.98902484, 96.98891051, 97.98879619, 98.98868186, 99.98856754,
            100.98845322, 101.98833889, 102.98822457, 103.98811024, 104.98799592,
            105.98788159, 106.98776727, 107.98765294, 108.98753862, 109.98742429,
            110.98730997, 111.98719564, 112.98708132, 113.98696700, 114.98685267,
            115.98673835, 116.98662402, 117.98650970, 118.98639537, 119.98628105,
            120.98616672, 121.98605240, 122.98593807, 123.98582375, 124.98570943,
            125.98559510, 126.98548078, 127.98536645, 128.98525213, 129.98513780,
            130.98502348, 131.98490915, 132.98479483, 133.98468050, 134.98456618,
            135.98445185, 136.98433753, 137.98422321, 138.98410888, 139.98399456,
            140.98388023, 141.98376591, 142.98365158, 143.98353726, 144.98342293,
            145.98330861, 146.98319428, 147.98307996, 148.98296563, 149.98285131,
            150.98273699, 151.98262266, 152.98250834, 153.98239401, 154.98227969,
            155.98216536, 156.98205104, 157.98193671, 158.98182239, 159.98170806,
            160.98159374, 161.98147941, 162.98136509, 163.98125077, 164.98113644,
            165.98102212, 166.98090779, 167.98079347, 168.98067914, 169.98056482,
            170.98045049, 171.98033617, 172.98022184, 173.98010752, 174.97999320,
            175.97987887, 176.97976455, 177.97965022, 178.97953590, 179.97942157,
            180.97930725, 181.97919292, 182.97907860, 183.97896427, 184.97884995,
            185.97873562, 186.97862130, 187.97850698, 188.97839265, 189.97827833,
            190.97816400, 191.97804968, 192.97793535, 193.97782103, 194.97770670,
            195.97759238, 196.97747805, 197.97736373, 198.97724940, 199.97713508,
            200.97702076, 201.97690643, 202.97679211, 203.97667778, 204.97656346,
            205.97644913, 206.97633481, 207.97622048, 208.97610616, 209.97599183,
            210.97587751, 211.97576318, 212.97564886, 213.97553454, 214.97542021,
            215.97530589, 216.97519156, 217.97507724, 218.97496291, 219.97484859,
            220.97473426, 221.97461994, 222.97450561, 223.97439129, 224.97427697,
            225.97416264, 226.97404832, 227.97393399, 228.97381967, 229.97370534,
            230.97359102, 231.97347669, 232.97336237, 233.97324804, 234.97313372,
            235.97301939, 236.97290507, 237.97279075, 238.97267642, 239.97256210,
            240.97244777, 241.97233345, 242.97221912, 243.97210480, 244.97199047,
            245.97187615, 246.97176182, 247.97164750, 248.97153317, 249.97141885,
            250.97130453, 251.97119020, 252.97107588, 253.97096155, 254.97084723,
            255.97073290, 256.97061858, 257.97050425, 258.97038993, 259.97027560,
            260.97016128, 261.97004695, 262.96993263, 263.96981831, 264.96970398,
            265.96958966, 266.96947533, 267.96936101, 268.96924668, 269.96913236,
            270.96901803, 271.96890371, 272.96878938, 273.96867506, 274.96856074,
            275.96844641, 276.96833209, 277.96821776, 278.96810344, 279.96798911,
            280.96787479, 281.96776046, 282.96764614, 283.96753181, 284.96741749,
            285.96730316, 286.96718884, 287.96707452, 288.96696019, 289.96684587,
            290.96673154, 291.96661722, 292.96650289, 293.96638857, 294.96627424,
            295.96615992, 296.96604559, 297.96593127, 298.96581694, 299.96570262,
            300.96558830, 301.96547397, 302.96535965, 303.96524532, 304.96513100,
            305.96501667, 306.96490235, 307.96478802, 308.96467370, 309.96455937,
            310.96444505, 311.96433072, 312.96421640, 313.96410208, 314.96398775,
            315.96387343, 316.96375910, 317.96364478, 318.96353045, 319.96341613,
            320.96330180, 321.96318748, 322.96307315, 323.96295883, 324.96284450,
            325.96273018, 326.96261586, 327.96250153, 328.96238721, 329.96227288,
            330.96215856, 331.96204423, 332.96192991, 333.96181558, 334.96170126,
            335.96158693, 336.96147261, 337.96135829, 338.96124396, 339.96112964,
            340.96101531, 341.96090099, 342.96078666, 343.96067234, 344.96055801,
            345.96044369, 346.96032936, 347.96021504, 348.96010071, 349.95998639,
            350.95987207, 351.95975774, 352.95964342, 353.95952909, 354.95941477,
            355.95930044, 356.95918612, 357.95907179, 358.95895747, 359.95884314,
            360.95872882, 361.95861449, 362.95850017, 363.95838585, 364.95827152,
            365.95815720, 366.95804287, 367.95792855, 368.95781422, 369.95769990,
            370.95758557, 371.95747125, 372.95735692, 373.95724260, 374.95712828,
            375.95701395, 376.95689963, 377.95678530, 378.95667098, 379.95655665,
            380.95644233, 381.95632800, 382.95621368, 383.95609935, 384.95598503,
            385.95587070, 386.95575638, 387.95564206, 388.95552773, 389.95541341,
            390.95529908, 391.95518476, 392.95507043, 393.95495611, 394.95484178,
            395.95472746, 396.95461313, 397.95449881, 398.95438448, 399.95427016,
            400.95415584, 401.95404151, 402.95392719, 403.95381286, 404.95369854,
            405.95358421, 406.95346989, 407.95335556, 408.95324124, 409.95312691,
            410.95301259, 411.95289826, 412.95278394, 413.95266962, 414.95255529,
            415.95244097, 416.95232664, 417.95221232, 418.95209799, 419.95198367,
            420.95186934, 421.95175502, 422.95164069, 423.95152637, 424.95141204,
            425.95129772, 426.95118340, 427.95106907, 428.95095475, 429.95084042,
            430.95072610, 431.95061177, 432.95049745, 433.95038312, 434.95026880,
            435.95015447, 436.95004015, 437.94992583, 438.94981150, 439.94969718,
            440.94958285, 441.94946853, 442.94935420, 443.94923988, 444.94912555,
            445.94901123, 446.94889690, 447.94878258, 448.94866825, 449.94855393,
            450.94843961, 451.94832528, 452.94821096, 453.94809663, 454.94798231,
            455.94786798, 456.94775366, 457.94763933, 458.94752501, 459.94741068,
            460.94729636, 461.94718203, 462.94706771, 463.94695339, 464.94683906,
            465.94672474, 466.94661041, 467.94649609, 468.94638176, 469.94626744,
            470.94615311, 471.94603879, 472.94592446, 473.94581014, 474.94569582,
            475.94558149, 476.94546717, 477.94535284, 478.94523852, 479.94512419,
            480.94500987, 481.94489554, 482.94478122, 483.94466689, 484.94455257,
            485.94443824, 486.94432392, 487.94420960, 488.94409527, 489.94398095,
            490.94386662, 491.94375230, 492.94363797, 493.94352365, 494.94340932,
            495.94329500, 496.94318067, 497.94306635, 498.94295202, 499.94283770,
            500.94272338, 501.94260905, 502.94249473, 503.94238040, 504.94226608,
            505.94215175, 506.94203743, 507.94192310, 508.94180878, 509.94169445,
            510.94158013, 511.94146580, 512.94135148, 513.94123716, 514.94112283,
            515.94100851, 516.94089418, 517.94077986, 518.94066553, 519.94055121,
            520.94043688, 521.94032256, 522.94020823, 523.94009391, 524.93997959,
            525.93986526, 526.93975094, 527.93963661, 528.93952229, 529.93940796,
            530.93929364, 531.93917931, 532.93906499, 533.93895066, 534.93883634,
            535.93872201, 536.93860769, 537.93849337, 538.93837904, 539.93826472,
            540.93815039, 541.93803607, 542.93792174, 543.93780742, 544.93769309,
            545.93757877, 546.93746444, 547.93735012, 548.93723579, 549.93712147,
            550.93700715, 551.93689282, 552.93677850, 553.93666417, 554.93654985,
            555.93643552, 556.93632120, 557.93620687, 558.93609255, 559.93597822,
            560.93586390, 561.93574957, 562.93563525, 563.93552093, 564.93540660,
            565.93529228, 566.93517795, 567.93506363, 568.93494930, 569.93483498,
            570.93472065, 571.93460633, 572.93449200, 573.93437768, 574.93426336,
            575.93414903, 576.93403471, 577.93392038, 578.93380606, 579.93369173,
            580.93357741, 581.93346308, 582.93334876, 583.93323443, 584.93312011,
            585.93300578, 586.93289146, 587.93277714, 588.93266281, 589.93254849,
            590.93243416, 591.93231984, 592.93220551, 593.93209119, 594.93197686,
            595.93186254, 596.93174821, 597.93163389, 598.93151956, 599.93140524,
            600.93129092, 601.93117659, 602.93106227, 603.93094794, 604.93083362,
            605.93071929, 606.93060497, 607.93049064, 608.93037632, 609.93026199,
            610.93014767, 611.93003334, 612.92991902, 613.92980470, 614.92969037,
            615.92957605, 616.92946172, 617.92934740, 618.92923307, 619.92911875,
            620.92900442, 621.92889010, 622.92877577, 623.92866145, 624.92854713,
            625.92843280, 626.92831848, 627.92820415, 628.92808983, 629.92797550,
            630.92786118, 631.92774685, 632.92763253, 633.92751820, 634.92740388,
            635.92728955, 636.92717523, 637.92706091, 638.92694658, 639.92683226,
            640.92671793, 641.92660361, 642.92648928, 643.92637496, 644.92626063,
            645.92614631, 646.92603198, 647.92591766, 648.92580333, 649.92568901,
            650.92557469, 651.92546036, 652.92534604, 653.92523171, 654.92511739,
            655.92500306, 656.92488874, 657.92477441, 658.92466009, 659.92454576,
            660.92443144, 661.92431711, 662.92420279, 663.92408847, 664.92397414,
            665.92385982, 666.92374549, 667.92363117, 668.92351684, 669.92340252,
            670.92328819, 671.92317387, 672.92305954, 673.92294522, 674.92283090,
            675.92271657, 676.92260225, 677.92248792, 678.92237360, 679.92225927,
            680.92214495, 681.92203062, 682.92191630, 683.92180197, 684.92168765,
            685.92157332, 686.92145900, 687.92134468, 688.92123035, 689.92111603,
            690.92100170, 691.92088738, 692.92077305, 693.92065873, 694.92054440,
            695.92043008, 696.92031575, 697.92020143, 698.92008710, 699.91997278,
            700.91985846, 701.91974413, 702.91962981, 703.91951548, 704.91940116,
            705.91928683, 706.91917251, 707.91905818, 708.91894386, 709.91882953,
            710.91871521, 711.91860088, 712.91848656, 713.91837224, 714.91825791,
            715.91814359, 716.91802926, 717.91791494, 718.91780061, 719.91768629,
            720.91757196, 721.91745764, 722.91734331, 723.91722899, 724.91711467,
            725.91700034, 726.91688602, 727.91677169, 728.91665737, 729.91654304,
            730.91642872, 731.91631439, 732.91620007, 733.91608574, 734.91597142,
            735.91585709, 736.91574277, 737.91562845, 738.91551412, 739.91539980,
            740.91528547, 741.91517115, 742.91505682, 743.91494250, 744.91482817,
            745.91471385, 746.91459952, 747.91448520, 748.91437087, 749.91425655,
            750.91414223, 751.91402790, 752.91391358, 753.91379925, 754.91368493,
            755.91357060, 756.91345628, 757.91334195, 758.91322763, 759.91311330,
            760.91299898, 761.91288465, 762.91277033, 763.91265601, 764.91254168,
            765.91242736, 766.91231303, 767.91219871, 768.91208438, 769.91197006,
            770.91185573, 771.91174141, 772.91162708, 773.91151276, 774.91139844,
            775.91128411, 776.91116979, 777.91105546, 778.91094114, 779.91082681,
            780.91071249, 781.91059816, 782.91048384, 783.91036951, 784.91025519,
            785.91014086, 786.91002654, 787.90991222, 788.90979789, 789.90968357,
            790.90956924, 791.90945492, 792.90934059, 793.90922627, 794.90911194,
            795.90899762, 796.90888329, 797.90876897, 798.90865464, 799.90854032,
            800.90842600, 801.90831167, 802.90819735, 803.90808302, 804.90796870,
            805.90785437, 806.90774005, 807.90762572, 808.90751140, 809.90739707,
            810.90728275, 811.90716842, 812.90705410, 813.90693978, 814.90682545,
            815.90671113, 816.90659680, 817.90648248, 818.90636815, 819.90625383,
            820.90613950, 821.90602518, 822.90591085, 823.90579653, 824.90568221,
            825.90556788, 826.90545356, 827.90533923, 828.90522491, 829.90511058,
            830.90499626, 831.90488193, 832.90476761, 833.90465328, 834.90453896,
            835.90442463, 836.90431031, 837.90419599, 838.90408166, 839.90396734,
            840.90385301, 841.90373869, 842.90362436, 843.90351004, 844.90339571,
            845.90328139, 846.90316706, 847.90305274, 848.90293841, 849.90282409,
            850.90270977, 851.90259544, 852.90248112, 853.90236679, 854.90225247,
            855.90213814, 856.90202382, 857.90190949, 858.90179517, 859.90168084,
            860.90156652, 861.90145219, 862.90133787, 863.90122355, 864.90110922,
            865.90099490, 866.90088057, 867.90076625, 868.90065192, 869.90053760,
            870.90042327, 871.90030895, 872.90019462, 873.90008030, 874.89996597,
            875.89985165, 876.89973733, 877.89962300, 878.89950868, 879.89939435,
            880.89928003, 881.89916570, 882.89905138, 883.89893705, 884.89882273,
            885.89870840, 886.89859408, 887.89847976, 888.89836543, 889.89825111,
            890.89813678, 891.89802246, 892.89790813, 893.89779381, 894.89767948,
            895.89756516, 896.89745083, 897.89733651, 898.89722218, 899.89710786,
            900.89699354, 901.89687921, 902.89676489, 903.89665056, 904.89653624,
            905.89642191, 906.89630759, 907.89619326, 908.89607894, 909.89596461,
            910.89585029, 911.89573596, 912.89562164, 913.89550732, 914.89539299,
            915.89527867, 916.89516434, 917.89505002, 918.89493569, 919.89482137,
            920.89470704, 921.89459272, 922.89447839, 923.76804888, 924.85878089,
            926.22111112, 927.39218533, 927.90145122, 928.16786174, 929.31315883,
            931.58836412, 933.46532159, 933.32049066, 932.08222213, 932.84320937,
            936.78347642, 940.53602019, 939.77647648, 935.62657787, 934.80208958,
            941.15449741, 948.86360305, 948.25110461, 939.23096317, 934.30840181,
            943.52676015, 958.73382542, 960.47539124, 943.69139781, 929.46058920,
            941.44535817, 971.46123301, 981.45455878, 950.22876974, 911.48855984,
            925.47497725, 999.98952550, 1048.50436178, 949.68521081, 664.83692375
    };
    double y[960] = {0};


    // 1. Test implementation methods

    // Test lowpass unwindowed filter created by sampling the spectrum
    hdsp_test(HDSP_STATUS_OK == hdsp_fir_filter_init_lowpass_by_spectrum_sampling(&filter, NUMBER_OF_POINTS,
                                                                                  FS_HZ, PASSBAND_FREQ_HZ),
              "Filter initialisation failed");
    hdsp_test(filter.b_len == NUMBER_OF_POINTS, "Wrong filter length");
    hdsp_test(filter.design_method == HDSP_FILTER_DESIGN_METHOD_SPECTRUM_SAMPLING, "Wrong design method");
    fprintf(stderr, "b:\n");
    hdsp_test_output_vector_with_newline_double(filter.b, filter.b_len);
    hdsp_test_vectors_equal_almost_double(filter.b, filter_ref, NUMBER_OF_POINTS);

    // Test lowpass unwindowed filter created by least squares method
    hdsp_test(HDSP_STATUS_FALSE == hdsp_fir_filter_init_lowpass_by_ls(&filter, 256, FS_HZ, PASSBAND_FREQ_HZ),
              "Filter initialisation should fail");

    // Fs=48000, Wpass=4000
    hdsp_test(HDSP_STATUS_OK == hdsp_fir_filter_init_lowpass_by_ls(&filter, HDSP_FIR_LS_KAISER_57_4000_48000_LEN,
                                                                      FS_HZ, 4000),
              "Filter initialisation failed");
    hdsp_test(filter.b_len == HDSP_FIR_LS_KAISER_57_4000_48000_LEN, "Wrong filter length");
    hdsp_test(filter.design_method == HDSP_FILTER_DESIGN_METHOD_LEAST_SQUARES, "Wrong design method");
    fprintf(stderr, "b:\n");
    hdsp_test_output_vector_with_newline_double(filter.b, filter.b_len);
    hdsp_test_vectors_equal_almost_double(filter.b, hdsp_fir_ls_57_4000_48000, filter.b_len);

    // Fs=48000, Wpass=8000
    hdsp_test(HDSP_STATUS_OK == hdsp_fir_filter_init_lowpass_by_ls(&filter, HDSP_FIR_LS_KAISER_75_8000_48000_LEN,
                                                                   FS_HZ, 8000),
              "Filter initialisation failed");
    hdsp_test(filter.b_len == HDSP_FIR_LS_KAISER_75_8000_48000_LEN, "Wrong filter length");
    hdsp_test(filter.design_method == HDSP_FILTER_DESIGN_METHOD_LEAST_SQUARES, "Wrong design method");
    fprintf(stderr, "b:\n");
    hdsp_test_output_vector_with_newline_double(filter.b, filter.b_len);
    hdsp_test_vectors_equal_almost_double(filter.b, hdsp_fir_ls_75_8000_48000, filter.b_len);

    // Test lowpass windowed filter created by least squares method

    // Fs=48000, Wpass=4000
    hdsp_test(HDSP_STATUS_OK == hdsp_fir_filter_init_lowpass_by_ls(&filter, HDSP_FIR_LS_KAISER_57_4000_48000_LEN,
                                                                   FS_HZ, 4000),
              "Filter initialisation failed");
    hdsp_kaiser_window(w, HDSP_FIR_LS_KAISER_57_4000_48000_LEN, HDSP_KAISER_FILTER_BETA_DEFAULT);
    hdsp_test(HDSP_STATUS_OK == hdsp_fir_filter_shape(&filter, w, HDSP_FIR_LS_KAISER_57_4000_48000_LEN),
              "Filter shape failed");
    hdsp_test_vectors_equal_almost_double(filter.b, hdsp_fir_ls_kaiser_57_4000_48000, filter.b_len);

    // Fs=48000, Wpass=8000
    hdsp_test(HDSP_STATUS_OK == hdsp_fir_filter_init_lowpass_by_ls(&filter, HDSP_FIR_LS_KAISER_75_8000_48000_LEN,
                                                                   FS_HZ, 8000),
              "Filter initialisation failed");
    hdsp_kaiser_window(w, HDSP_FIR_LS_KAISER_75_8000_48000_LEN, HDSP_KAISER_FILTER_BETA_DEFAULT);
    hdsp_test(HDSP_STATUS_OK == hdsp_fir_filter_shape(&filter, w, HDSP_FIR_LS_KAISER_75_8000_48000_LEN),
              "Filter shape failed");
    hdsp_test_vectors_equal_almost_double(filter.b, hdsp_fir_ls_kaiser_75_8000_48000, filter.b_len);

    // 2. Test interface

    // Test lowpass unwindowed filter created by sampling the spectrum
    hdsp_test(HDSP_STATUS_OK == hdsp_fir_filter_init_lowpass(&filter, NUMBER_OF_POINTS, FS_HZ, PASSBAND_FREQ_HZ,
                                                             HDSP_FILTER_DESIGN_METHOD_SPECTRUM_SAMPLING),
              "Filter initialisation failed");
    hdsp_test(filter.b_len == NUMBER_OF_POINTS, "Wrong filter length");
    hdsp_test(filter.design_method == HDSP_FILTER_DESIGN_METHOD_SPECTRUM_SAMPLING, "Wrong design method");
    fprintf(stderr, "b:\n");
    hdsp_test_output_vector_with_newline_double(filter.b, filter.b_len);
    hdsp_test_vectors_equal_almost_double(filter.b, filter_ref, NUMBER_OF_POINTS);

    // Test lowpass unwindowed filter created by least squares method
    hdsp_test(HDSP_STATUS_FALSE == hdsp_fir_filter_init_lowpass(&filter, 256, FS_HZ, PASSBAND_FREQ_HZ,
                                                                      HDSP_FILTER_DESIGN_METHOD_LEAST_SQUARES),
              "Filter initialisation should fail");

    // Fs=48000, Wpass=4000
    hdsp_test(HDSP_STATUS_OK == hdsp_fir_filter_init_lowpass(&filter, HDSP_FIR_LS_KAISER_57_4000_48000_LEN, FS_HZ,
                                                                   4000, HDSP_FILTER_DESIGN_METHOD_LEAST_SQUARES),
              "Filter initialisation failed");
    hdsp_test(filter.b_len == HDSP_FIR_LS_KAISER_57_4000_48000_LEN, "Wrong filter length");
    hdsp_test(filter.design_method == HDSP_FILTER_DESIGN_METHOD_LEAST_SQUARES, "Wrong design method");
    fprintf(stderr, "b:\n");
    hdsp_test_output_vector_with_newline_double(filter.b, filter.b_len);
    hdsp_test_vectors_equal_almost_double(filter.b, hdsp_fir_ls_57_4000_48000, filter.b_len);

    // Fs=48000, Wpass=8000
    hdsp_test(HDSP_STATUS_OK == hdsp_fir_filter_init_lowpass(&filter, HDSP_FIR_LS_KAISER_75_8000_48000_LEN, FS_HZ,
                                                                   8000, HDSP_FILTER_DESIGN_METHOD_LEAST_SQUARES),
              "Filter initialisation failed");
    hdsp_test(filter.b_len == HDSP_FIR_LS_KAISER_75_8000_48000_LEN, "Wrong filter length");
    hdsp_test(filter.design_method == HDSP_FILTER_DESIGN_METHOD_LEAST_SQUARES, "Wrong design method");
    fprintf(stderr, "b:\n");
    hdsp_test_output_vector_with_newline_double(filter.b, filter.b_len);
    hdsp_test_vectors_equal_almost_double(filter.b, hdsp_fir_ls_75_8000_48000, filter.b_len);

    // Test filters that meet spec
    hdsp_test(HDSP_STATUS_OK == hdsp_fir_filter_init_lowpass_kaiser_opt(&filter, 48000, 4000),
              "Failed to init Kaiser lowpass 4000/48000 filter");
    hdsp_test(filter.b_len == HDSP_FIR_LS_KAISER_57_4000_48000_LEN, "Wrong filter length");
    hdsp_test_vectors_equal_almost_double(filter.b, hdsp_fir_ls_kaiser_57_4000_48000, filter.b_len);
    hdsp_test_output_vector_with_newline(x_ref, 4);
    hdsp_test(HDSP_STATUS_OK == hdsp_fir_filter(x_ref, 960, &filter, y, 960), "FIR filtering failed");
    hdsp_test_vectors_equal_almost_double(y, y_57_ref, 960);
    hdsp_test_output_vector_with_newline(x_ref, 4);

    memset(y, 0, sizeof(y[0])*960);
    hdsp_test(HDSP_STATUS_OK == hdsp_fir_filter_init_lowpass_kaiser_opt(&filter, 48000, 8000),
              "Failed to init Kaiser lowpass 8000/48000 filter");
    hdsp_test(filter.b_len == HDSP_FIR_LS_KAISER_75_8000_48000_LEN, "Wrong filter length");
    hdsp_test_vectors_equal_almost_double(filter.b, hdsp_fir_ls_kaiser_75_8000_48000, filter.b_len);
    hdsp_test(HDSP_STATUS_OK == hdsp_fir_filter(x_ref, 960, &filter, y, 960), "FIR filtering failed");
    hdsp_test_output_vector_with_newline_double(y, 10);
    hdsp_test_output_vector_with_newline(x_ref, 5);
    hdsp_test_vectors_equal_almost_double(y, y_75_ref, 960);

    return 0;
}